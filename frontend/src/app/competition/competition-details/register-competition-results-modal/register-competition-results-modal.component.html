<div class="modal-header">
  <h4 class="modal-title">
    Registrer resultater 
    <small class="text-muted">{{competition?.navn}}</small>
  </h4>
  <button type="button" class="close" aria-label="Lukk" (click)="_activeModal.dismiss('Cross click')">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<div class="modal-body">
  <!--<label class="font-weight-bold">Konkurranseklasse</label>
  <select [(ngModel)]="selectedCompetitionClass" class="form-control" name="klasseID">
    <option *ngFor="let c of competitionClasses" [ngValue]="c.klasseID">
      {{c?.navn}}
    </option>
  </select>-->
  <div *ngIf="warning" class="alert alert-danger">
    {{warning}}
  </div>
  <form #registerResultsForm="ngForm" (keyup.enter)="saveParticipantResult()" class="">
    
    <div class="form-group" *ngIf="currentParticipant">
        <div class="row pt-2">
          <div class="col" *ngIf="!registerForTeams">
            <button type="button" class="btn btn-primary" (click)="setParticipant(prevParticipantWithoutTime())">Forrige uten tid</button>
            <button type="button" class="btn btn-primary" (click)="setParticipant(participantIdx - 1)">Forrige</button>
            <button type="button" class="btn btn-primary" (click)="setParticipant(participantIdx + 1)">Neste</button>
            <button type="button" class="btn btn-primary" (click)="setParticipant(nextParticipantWithoutTime())">Neste uten tid</button>
          </div>
          <div class="col" *ngIf="registerForTeams">
              <button type="button" class="btn btn-primary" (click)="setTeam(prevTeamWithoutTime())">Forrige uten tid</button>
              <button type="button" class="btn btn-primary" (click)="setTeam(teamIdx - 1)">Forrige</button>
              <button type="button" class="btn btn-primary" (click)="setTeam(teamIdx + 1)">Neste</button>
              <button type="button" class="btn btn-primary" (click)="setTeam(nextTeamWithoutTime())">Neste uten tid</button>
            </div>
        </div>
        <div *ngIf="hasTeams" class="row mt-3 ml-2 mb-0 form-group">
          <div class="col">
            <label class="big-checkbox">
              <input type="checkbox" id="checkboxTeam" 
                [value]="registerForTeams"
                [checked]="registerForTeams"
                (change)="registerForTeams = !registerForTeams">
                Registrer for lag
            </label>
          </div>
        </div> 
        <div class="row pt-3">
          <div class="form-group col" *ngIf="!registerForTeams">
            <label class="font-weight-bold" for="startnummer">Startnummer</label>
            <input [ngModel]="currentParticipant.startNummer" (change)="setParticipantByStartnummer($event)" 
                    type="number" class="form-control w-50" name="startnummer" placeholder="">
          </div>
          <div class="form-group col" *ngIf="registerForTeams">
              <label class="font-weight-bold" for="startdiff">Lagnummer</label>
              <div class="input-group w-50">
                <input [ngModel]="currentTeam.lagNummer" (change)="setTeamByTeamNumber($event)" 
                        type="number" class="form-control w-50" name="lagnummer" placeholder="">
              </div>
            </div>
          <div class="col">
            <label class="" for="startdiff">Standard startdiff.</label>
            <div class="input-group w-50">
              <input [(ngModel)]="competition.startInterval"
                     (change)="saveStartInterval()" 
                     type="number" class="form-control w-50" name="startdiff" placeholder="">
              <div class="input-group-addon hidden-sm-down">sekund(er)</div>
            </div>
          </div>
        </div>
        <div class="row" *ngIf="findParticipantMessage">
            <div class="text-danger">{{findParticipantMessage}}</div>
        </div>
        <div class="row">
          <div class="col" *ngIf="!registerForTeams">
            <div class="font-weight-bold text-muted">{{currentParticipant?.person?.fornavn}} {{currentParticipant?.person?.etternavn}} ({{currentParticipant?.person?.fodselsar}})</div>
            <div class="text-muted">{{currentParticipant?.klasseID}}</div>
          </div>
          <div class="col" *ngIf="registerForTeams">
              <div class="font-weight-bold text-muted" [innerHtml]="currentTeam?.lagNavn"></div>
              <div class="text-muted">{{currentTeam?.klasseID}}</div>
            </div>
        </div>
        <div class="row">
          <div class="form-group col">
            <label class="font-weight-bold" for="starttid">Starttid {{startTime?.duration?.seconds}}</label>
            <ngb-timepicker [(ngModel)]="startTime.duration" (change)="updateTidsforbruk()" [spinners]="false" [seconds]="true" name="tp-startTime"></ngb-timepicker>
          </div>
          <div class="form-group col">
            <label class="font-weight-bold" for="sluttid">Sluttid</label>
            <ngb-timepicker [(ngModel)]="endTime.duration" (change)="updateTidsforbruk()" [spinners]="false" [seconds]="true" name="tp-endtime"></ngb-timepicker>
          </div>
        </div>
        <div class="row">
          <div class="form-group col">
            <button type="button" class="btn btn-primary btn-sm" (click)="addSeconds(15)">+15 sek</button>
            <button type="button" class="btn btn-primary btn-sm" (click)="addSeconds(30)">+30 sek</button>
          </div>
          <div class="form-group col">
            <label class="font-weight-bold" for="tidsforbruk">Tid</label>
            <ngb-timepicker [(ngModel)]="totalTime.duration" [spinners]="false" [seconds]="true" name="tp-totalTime" disabled></ngb-timepicker>
          </div>
        </div>
    </div>
  </form>
</div>
<div class="modal-footer">
  <div class="alert alert-success" *ngIf="lastSaved">Sist lagret: <span class="font-weight-bold" [innerHtml]="lastSaved"></span></div>
  <button type="submit" class="btn btn-primary" [disabled]="!registerResultsForm.valid || disableSave || !currentParticipant || (hasTeams && !currentTeam)" (click)="saveParticipantResult()">Oppdater</button>
  <button type="button" class="btn btn-secondary" (click)="_activeModal.close('Close click')">Lukk</button>
</div>